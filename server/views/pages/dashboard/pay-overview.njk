{% extends "layout.njk" %}

{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% set pageTitle = applicationName + " - Pay Overview" %}
{% set mainClasses = "govuk-body" %}
{% set backLinkHref = "../../" %}

{% set weekPay = (payType.dailyPayAmount * 5) / 100 %}
{% set payTypeDescriptionLower = payType.description | lower %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <h1 class="govuk-heading-l">{{ payType.description }}</h1>
            {# Following line needs to be made generic #}
            <p class="govuk-body">People have been signed off for more than 4 weeks</p> 
            <p class="govuk-body">They're paid {{ payType.dailyPayAmount }}p per day (Â£{{ weekPay }} for a 5 day week)</p>

            {{ govukButton({
                text: "Add someone to " + payTypeDescriptionLower,
                href: './register/add-prisoner',
                attributes: {
                    'data-qa': 'add-to-pay-type-button'
                }
            }) }}

            {% set rows = [] %}
            {% for row in records %}
                {% if row.endDate %}
                    {% set changeLink = '<a href="./remove/' + row.id + '/removal-date">Change end date</a>' %}
                {% else %}
                    {% set changeLink = '<a href="./remove/' + row.id + '/removal-date">Remove from ' + payTypeDescriptionLower + '</a>' %}
                {% endif %}
                {% set rows = (rows.push([
                    {
                        text: row | formatName(NameFormatStyle.firstLast, false)
                    }, {
                        text: row.cellLocation
                    }, {
                        text: row.startDate | formatDate('d MMM yyyy')
                    }, {
                        text: row.endDate | formatDate('d MMM yyyy')
                    }, {
                        text: ''
                    }, {
                        html: changeLink
                    }
                ]), rows) %}
            {% endfor %}
            {{ govukTable({
                attributes: {
                    'data-module': 'moj-sortable-table',
                    'data-table-fixed-rows': 'true',
                    'data-qa': 'pay-overview-table'
                },
                caption: "Preview",
                captionClasses: "govuk-visually-hidden",
                head: [
                    {
                        text: "Prisoner Details",
                        attributes: { "aria-sort": "ascending" }
                    }, 
                    {
                        text: "Cell location",
                        attributes: { "aria-sort": "none" }
                    }, 
                    {
                        text: "Date added to " + payTypeDescriptionLower,
                        attributes: { "aria-sort": "none" }
                    },
                    {
                        text: "End Date",
                        attributes: { "aria-sort": "none" }
                    },
                    {
                        text: "Current allocations",
                        attributes: { "aria-sort": "none" }
                    },
                    {
                        text: ""
                    }
                ],
                rows: rows,
                classes: "govuk-!-margin-bottom-6"
            }) }}
        </div>
    </div>
{% endblock %}